<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>music</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }

      body {
        padding-top: 80px;
      }
      ul {
        list-style: none;
      }
      input {
        outline: none;
        padding: 6px;
        width: 50%;
        max-width: 300px;
      }
      button {
        user-select: none;
        padding: 6px;
      }
      header,
      footer {
        text-align: center;
        display: inherit;
        padding: 20px;
        background: #b7b7b7;
        right: 0;
        position: fixed;
        left: 0;
      }

      header {
        top: 0;
      }

      footer {
        bottom: 0;
        color: white;
      }

      .act {
        color: #a2a2a2;
      }
      td,
      tr {
        padding-top: 16px;
      }
      .list {
        text-align: center;
      }
    </style>
  </head>

  <body>
    <header>
      <input id="name" placeholder="周杰伦" type="text" />
      <button onclick="search()">search</button>
    </header>
    <div class="list">
      <p id="show"></p>
      <table style="display: inline">
        <tr>
          <td>fdfad</td>
          <td>fdfad</td>
        </tr>
      </table>
    </div>
    <footer>play</footer>
    <script>
      function test() {
        const list = [
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
          {
            name: "fdafa",
            act: "fdafa",
            dates: "fdaf",
          },
        ];

        data(list);
      }

      test();

      function search() {
        var v = document.querySelector("#name").value || "周杰伦";
        document.querySelector("table").innerHTML = "";
        document.querySelector("#show").innerHTML = "search...";
        fetch("/api/mp3/search?name=" + v)
          .then((rsp) => rsp.json())
          .then((res) => data(res))
          .catch(() => {
            document.querySelector("table").innerHTML = "";
            document.querySelector("#show").innerHTML = "search error.";
          });
      }

      function music(token) {
        fetch("/api/mp3/song?token=" + token)
          .then((rsp) => rsp.text())
          .then((res) => {
            window.open(res);
          });
      }

      function data(res) {
        var list = [];
        res.forEach((obj) => {
          const { name, act, dates } = obj;
          list.push(
            `<tr><td><a href="javascript:;" onclick="music('${dates}')">${name}</a></td><td class="act">${act}</td></tr>`
          );
        });

        document.querySelector("table").innerHTML = list.join("");
        document.querySelector("#show").innerHTML = "";
      }
    </script>
  </body>
</html>
